# Use your energy consumption data by converting it to the boamps format 


## Overview 

This tool is used to generate data in BoAmps json format from data collected in another format (e.g., codecarbon CSV). The scripts given are independent of the input data format, however the configuration files (in the folder data>conf) are specific to the output csv generated by codecarbon, you'll need to customize them if you use another tool/format.


To make this conversion, the tool is composed of 2 steps. The first one is to generate a textfile, resembling a form that contains boamps fields and that is automatically filled in with your input data. You can manually correct this file and add precious information about your AI system. The second step is to transform this textfile into a json that follows the boamps format.


## Usage: how to run the scripts

The scripts need to be run in a Linux bash command line

### Script 1 : `gen_form.sh`

Generate a text form having the rights fields, and containing the relevant information from the data provided. This file can then be completed by hand to fill in any missing elements (such as the description of the AI task, for example). The corresponding script is `gen_form.sh`.
Here is an example of how you can use it : 
1. Replace codecarbon_file.csv with your own input file.
2. Adapt config_nb_fieds with your own number of algorithms, data etc (/!\ don't change the fileds name, just the numbers ! )
3. Run the script! Example of command with the test files provided : 
./scripts/gen_form.sh -a ./data/conf/boamps_auto_prefill_codecarbon.csv ./data/conf/config_nb_fields_boamps.conf ./data/input/codecarbon_file.csv 2 > ./data/output/form_prefilled.txt

You may have to wait few minutes to have the full form generated.

Explanations of the args : 
- boamps_auto_prefill_codecarbon.csv : This file is a configuration file, we give you a default one, which propose a conversion between codecarbon fields and boamps schema fields. You can customize this configuration file, especially if you want to use an input file other than codecarbon csv files.
- config_nb_fields_boamps.conf : File allowing to modulate the number of sections in the form (how many algorithms, dataset etc you need to describe). Don't modify the fields name but only the number to generate what corresponds to your configuration 
- codecarbon_file.csv: Sample CSV file containing emissions data generated with CodeCarbon that is uses as inout data for the conversion. This file is there only for test purposes, you should replace it with your own data !
- report-codecarbon-prefill.txt : is the output textfile that is generated prefilled (with the data of the 2nd line of the codecarbon_file.csv) you need to complete/correct before using the 2nd script.

### Script 2 : `form2json.sh`

Convert the completed form to the Boamps JSON format 
The corresponding script is `form2json.sh` 
- exemple: ./scripts/form2json.sh -a ./data/conf/boamps_auto_prefill_codecarbon.csv ./data/output/form_prefilled.txt > ./data/output/boamps_report.json

Explanations of the args : 
- boamps_auto_prefill_codecarbon.csv : This file is a configuration file, we give you a default one, which propose a conversion between codecarbon fields and boamps schema fields. You can customize this configuration file, especially if you want to use an input file other than codecarbon csv files.
- report-codecarbon-prefill.txt : is the output textfile generated by the first script, that you completed manually
- boamps_report.json : is the generated json file that contains all the relevant information and follows the Boamps format!
  
### Customization 

How to customize boamps_auto_prefill_codecarbon.csv ?

In the `boamps_auto_prefill_codecarbon.csv` file, you will find the Boamps format with, in addition, in the `cmd` column, the tools to pre-fill from an input CSV.
Note : The `boamps_auto_prefill_codecarbon.csv` file we share is a reference file that contains in the cmd fields instructions to prefill the form with the CodeCarbon CSV output format. If you don't use this format of input data, you need to modify this `cmd` column.

There are several options for filling the `cmd` column:
- Just a string (without # or :) indicates the name of the column in the input CSV to put in the form field.
- String preceded by a # (without # or : in the rest of the string): puts in the form field the value of the string without the # (fixed value).
- String containing : (without # in the string): represents a list separated by :, each element (CSV column) will be put in the form iteration according to its position in the described list.
- If no column matches an entry of type String, float, etc. (outside object and end), put: no (to fill nothing in the form).
- You can also hybridize # and : to make a list where in the first iteration, you put a fixed value, but in the second, you put the element (CSV column).


## Example Files
Here is a list and information about the sample or example files provided :
- form_example.txt: Example of a form generated by `gen_form.sh` with `boamps_auto_prefill_codecarbon.csv` , `config_nb_fields_boamps.conf` and the second line of codecarbon_file.csv.
- json_example.json: Example of a JSON file generated by `form2json.sh` from the `form_example.txt`. (Beware it contain only field present in the codecarbon csv mandatory fields must be added)


## Troubleshooting:
- if you have this error: "/bin/bash^M: bad interpreter: No such file or directory" -> use this command: `sed -i -e 's/\r$//' <script_name>`

## Change log

**gen_form.sh:**
- v0.81 : 
  - Correction to accept in the cmd column string with spaces with for the # option

**form2json.sh:**
- v0.87 : 
  - Correction to accept string with spaces in the form and put it inside the json trimming only space before and after the string and not all the spaces.
  - Correction to don't put a last comma in the JSON file if the quality field is not null
