# BoAmps JSON Generator

Convert your energy consumption data to the BoAmps format with this conversion tool.

## üéØ Overview 

This tool converts energy consumption data from various formats (e.g., CodeCarbon CSV) to the standardized BoAmps JSON format. While the core scripts are format-agnostic, the provided configuration files are specifically designed for CodeCarbon CSV output. For other formats, you'll need to customize the configuration files.

### Two-Step Conversion Process

1. **Form Generation**: Creates a human-readable text form pre-filled with your data
2. **JSON Conversion**: Transforms the completed form into BoAmps-compliant JSON

## üìã Prerequisites

- Environment with bash shell
- Input data file (e.g., CodeCarbon CSV)
- Configuration files adapted to your data format

## üöÄ Quick Start

### Step 1: Generate Pre-filled Form

The `gen_form.sh` script creates a text form with the appropriate BoAmps fields, automatically populated with your input data.

1. Insert your own input data (e.g Codecarbon CSV file)
2. Customize the config_file (boamps_auto_prefill_codecarbon.csv) if necessary (if you're input data is not at the codecarbon report format)
3. Customize the fields_config (to detail how many algorithms, data, measure etc you want to describe in your report)
4. Run the script :
   
**Usage:**
```bash
./scripts/gen_form.sh -a <config_file> <fields_config> <input_data> <line_number> > <output_form>
```

**Example:**
```bash
./scripts/gen_form.sh -a ./data/conf/boamps_auto_prefill_codecarbon.csv ./data/conf/config_nb_fields_boamps.conf ./data/input/codecarbon_file.csv 1 > ./data/output/form_prefilled.txt
```

**Parameters:**
- <config_file>: Configuration mapping between input format and BoAmps schema
- <fields_config>: Defines the number of sections (algorithms, datasets, etc.)
- <input_data>: Your input data file
- <line_number>: Line number to process (header = 0, first data line = 1)
- <output_form>: Output form file

‚è±Ô∏è **Processing time**: May take a few minutes

### Step 2: Convert Form to JSON

After reviewing and completing the generated form, use `form2json.sh` to create the final BoAmps JSON.

**Usage:**
```bash
./scripts/form2json.sh -a <config_file> <completed_form> > <output_json>
```

**Example:**
```bash
./scripts/form2json.sh -a ./data/conf/boamps_auto_prefill_codecarbon.csv ./data/output/form_prefilled.txt > ./data/output/boamps_report.json
```
You may have to wait few minutes to have the full form generated.

Explanations of the args : 
- <config_file> : This file is a configuration file, we give you a default one, which propose a conversion between codecarbon fields and boamps schema fields. You can customize this configuration file, especially if you want to use an input file other than codecarbon csv files.
- <completed_form> : is the output textfile generated by the first script, that you completed manually
- <output_json> : is the generated json file that contains all the relevant information and follows the Boamps format!



### Verification 

Verify your generated JSON against the BoAmps schema. Once you're done and your data is generated, you can verify that it is well formatted using the boamps schema validator : 
```
cd ../../schema_validator/
python ./validate-schema.py ./../json_generator/bash/data/output/boamps_report.json
```

## ‚öôÔ∏è Configuration

### File Structure
```
data/
‚îú‚îÄ‚îÄ conf/
‚îÇ   ‚îú‚îÄ‚îÄ boamps_auto_prefill_codecarbon.csv  # Field mapping configuration
‚îÇ   ‚îî‚îÄ‚îÄ config_nb_fields_boamps.conf        # Form structure configuration
‚îú‚îÄ‚îÄ input/
‚îÇ   ‚îî‚îÄ‚îÄ codecarbon_file.csv                 # Your input data (replace with yours)
‚îî‚îÄ‚îÄ output/
    ‚îú‚îÄ‚îÄ form_prefilled.txt                  # Generated form
    ‚îî‚îÄ‚îÄ boamps_report.json                  # Final BoAmps JSON
```

### Customizing the Field Mapping (`boamps_auto_prefill_codecarbon.csv`)

This configuration file maps your input data fields to BoAmps schema fields. The `cmd` column supports several mapping options:

| Format | Description | Example |
|--------|-------------|---------|
| `column_name` | Direct column mapping | `energy_consumed` |
| `#fixed_value` | Static value | `#GPU Training` |
| `col1:col2:col3` | List mapping | `gpu_name:cpu_name:ram_type` |
| `#val1:col2:#val3` | Mixed list (static + dynamic) | `#PyTorch:model_name:#Classification` |
| `no` | Skip field | `no` |

### Customizing Form Structure (`config_nb_fields_boamps.conf`)

Configure the number of sections in your form:

- `nbAlgo`: Number of algorithms to describe
- `nbDataset`: Number of datasets to include  
- `nbMeasures`: Number of measurement sections
- `infraComponents`: Number of infrastructure components

‚ö†Ô∏è **Important**: Only modify the numbers, not the field names!

## üõ†Ô∏è Troubleshooting

### Common Issues

**Line ending problems:**
```bash
# Fix: "/bin/bash^M: bad interpreter" error
sed -i -e 's/\r$//' scripts/gen_form.sh
sed -i -e 's/\r$//' scripts/form2json.sh
```

**Permission errors:**
```bash
# Make scripts executable
chmod +x scripts/*.sh
```

## üìù Version History

### gen_form.sh
- **v0.81**: Fixed handling of strings with spaces in `cmd` column with `#` option

### form2json.sh  
- **v0.87**: 
  - Improved string handling with spaces (preserves internal spaces, trims edges only)
  - Fixed JSON formatting to avoid trailing commas when quality field is null


## üìö Additional Resources

- See `doc_codecarbon_prefill.md` for detailed field mapping documentation
- Use the schema validator to ensure compliance with BoAmps format
- Check the `data/conf/` directory for example configurations
